name: Test Packaged SDKs

on:
  workflow_dispatch:
  push:
    paths:
      .github/workflows/**


jobs:
  test-server-sdks:
    strategy:
      fail-fast: false
      matrix:
        sdk:
          - { sdkName: "eppo/php-sdk",
              sdkRelayDir: "php-sdk-relay"}

          - { sdkName: "dotnet-server",
              sdkRelayDir: "dotnet-sdk-relay",
              skipPlatforms: '["macos"]' }

        platform: ['macos', 'linux']
    uses: ./.github/workflows/test-server-sdk.yml
    with:
      platform: ${{ matrix.platform }}
      sdkName: ${{ matrix.sdk.sdkName }}
      sdkRelayDir: ${{ matrix.sdk.sdkRelayDir }}
      skipPlatforms: ${{ matrix.sdk.skipPlatforms }}
    secrets: inherit
